# 카메라 및 색상 구분 테스트 가이드

## 테스트 스크립트 실행

### 1. 카메라 테스트
```bash
python test_camera_roi.py
```

## 테스트 항목

### ✅ 카메라 방향 확인
테스트 스크립트를 실행하면 다음 키로 카메라 회전을 테스트할 수 있습니다:

- **f 키**: 상하 반전 (Flip Vertical)
- **h 키**: 좌우 반전 (Flip Horizontal)
- **r 키**: 180도 회전 (Flip Both)
- **n 키**: 원본으로 복원 (No Flip)

**확인 방법:**
1. 테스트 스크립트 실행
2. 화면에 보이는 이미지가 정상인지 확인
3. 만약 거꾸로 보이면 적절한 키를 눌러 회전
4. 정상으로 보이는 flip 모드를 기억

**메인 코드에 적용:**
```python
# dual_roi_line_tracer.py의 main() 함수에서
ret, frame = cap.read()
if not ret:
    break

# 카메라 회전 적용 (필요한 경우)
# frame = cv2.flip(frame, 0)   # 상하 반전
# frame = cv2.flip(frame, 1)   # 좌우 반전
# frame = cv2.flip(frame, -1)  # 180도 회전
```

### ✅ 우측 하단 색상 구분 확인

테스트 스크립트는 6개의 창을 표시합니다:

1. **Camera Test - Main**: 전체 화면 + ROI 박스 표시
2. **Left ROI (Original)**: 좌측 하단 원본 영상
3. **Right ROI (Original)**: 우측 하단 원본 영상
4. **Left ROI (Binary)**: 좌측 하단 이진화 영상
5. **Right ROI (Binary)**: 우측 하단 이진화 영상

**확인 사항:**

#### 1) ROI 위치 확인
- 화면 좌측 하단에 **파란색 박스** (LEFT ROI)
- 화면 우측 하단에 **초록색 박스** (RIGHT ROI)
- 두 박스가 라인 트랙의 양쪽을 포함하는지 확인

#### 2) 색상 구분 확인
메인 화면에 다음 정보가 표시됩니다:
```
Left Pixels: 1234      # 좌측 감지된 라인 픽셀 수
Right Pixels: 5678     # 우측 감지된 라인 픽셀 수
Left Brightness: 45.3  # 좌측 평균 밝기
Right Brightness: 52.1 # 우측 평균 밝기
```

**테스트 방법:**
1. 라인이 없는 곳에 카메라를 두면 → Pixels 값이 적어야 함
2. 라인이 있는 곳에 카메라를 두면 → Pixels 값이 많아야 함
3. Binary 창에서 흰색 부분이 라인으로 감지되는 영역

#### 3) 임계값 조정
- **1 키**: 임계값 감소 (더 어두운 선도 감지)
- **2 키**: 임계값 증가 (밝은 선만 감지)

**조정 팁:**
- 라인이 감지 안 되면 → 1 키를 눌러 임계값 낮춤
- 너무 많이 감지되면 → 2 키를 눌러 임계값 높임
- Binary 창에서 라인 부분만 흰색으로 나오도록 조정

## 테스트 결과 해석

### 정상 동작 기준

#### 라인 위에 있을 때:
- Left Pixels: 500 이상
- Right Pixels: 500 이상
- 제어 명령: FORWARD

#### 좌측 라인 이탈:
- Left Pixels: 100 이하
- Right Pixels: 500 이상
- 제어 명령: LEFT (좌회전하여 라인 복귀)

#### 우측 라인 이탈:
- Left Pixels: 500 이상
- Right Pixels: 100 이하
- 제어 명령: RIGHT (우회전하여 라인 복귀)

#### 완전 이탈:
- Left Pixels: 100 이하
- Right Pixels: 100 이하
- 제어 명령: STOP

## 일반적인 문제 해결

### 문제 1: 카메라가 거꾸로 보임
**해결:**
1. 테스트 스크립트에서 올바른 flip 모드 찾기
2. 메인 코드에 해당 flip 적용

### 문제 2: 라인을 전혀 감지 못함
**해결:**
1. 1 키를 눌러 임계값을 낮춤 (최소 60까지)
2. 조명을 밝게 하거나 어둡게 조정
3. 라인 색상이 검은색인지 확인

### 문제 3: 너무 많은 영역이 감지됨
**해결:**
1. 2 키를 눌러 임계값을 높임 (최대 220까지)
2. Binary 창에서 라인만 흰색으로 나올 때까지 조정

### 문제 4: ROI 위치가 적절하지 않음
**해결:**
- 테스트 스크립트의 `roi_height_ratio`, `roi_width_ratio` 값 조정
- 메인 코드에도 동일하게 적용

## 최종 확인 사항

테스트가 완료되면 다음을 확인:

✅ 카메라 방향이 정상인가?
✅ 좌측 ROI가 라인을 올바르게 감지하는가?
✅ 우측 ROI가 라인을 올바르게 감지하는가?
✅ 임계값이 적절히 조정되었는가?
✅ Binary 이미지에서 라인만 흰색으로 보이는가?

모두 확인되면 메인 라인 트레이싱 코드를 실행할 준비가 완료된 것입니다!

## 메인 코드 실행

```bash
python dual_roi_line_tracer.py
```

실시간으로 파라미터를 조정하면서 최적의 설정을 찾으세요.
